angular.module("auth",[]),angular.module("auth").factory("AuthService",["$http","$window",function(t,e){var o={};return o.saveToken=function(t){e.localStorage["flapper-news-token"]=t},o.getToken=function(){return e.localStorage["flapper-news-token"]},o.isLoggedIn=function(){var t=o.getToken();if(t){var n=JSON.parse(e.atob(t.split(".")[1]));return n.exp>Date.now()/1e3}return!1},o.currentUser=function(){if(o.isLoggedIn()){var t=o.getToken(),n=JSON.parse(e.atob(t.split(".")[1]));return n.username}},o.register=function(e){return t.post("/register",e).success(function(t){o.saveToken(t.token)})},o.logIn=function(e){return t.post("/login",e).success(function(t){o.saveToken(t.token)})},o.logOut=function(){e.localStorage.removeItem("flapper-news-token")},o}]),angular.module("auth").controller("AuthCtrl",["$scope","$state","AuthService",function(t,e,o){t.user={},t.register=function(){o.register(t.user).error(function(e){t.error=e}).then(function(){e.go("home")})},t.logIn=function(){o.logIn(t.user).error(function(e){t.error=e}).then(function(){e.go("home")})}}]),angular.module("nav",["auth"]),angular.module("nav").controller("NavCtrl",["$scope","AuthService",function(t,e){t.isLoggedIn=e.isLoggedIn,t.currentUser=e.currentUser,t.logOut=e.logOut}]),angular.module("posts",["auth"]),angular.module("posts").factory("PostsService",["$http","AuthService",function(t,e){var o={posts:[]};return o.getAll=function(){return t.get("/posts").success(function(t){angular.copy(t,o.posts)})},o.create=function(e){return t.post("/posts",e).success(function(t){o.posts.push(t)})},o.upvote=function(e){return t.put("/posts/"+e._id+"/upvote").success(function(t){e.upvotes+=1})},o.get=function(e){return t.get("/posts/"+e).then(function(t){return t.data})},o["delete"]=function(e){return t["delete"]("/posts/"+e._id).success(function(t){angular.copy(t,o.posts)})},o.addComment=function(e,o){return t.post("/posts/"+e+"/comments",o)},o.upvoteComment=function(e,o){return t.put("/posts/"+e._id+"/comments/"+o._id+"/upvote").success(function(t){o.upvotes+=1})},o.create=function(n){return t.post("/posts",n,{headers:{Authorization:"Bearer "+e.getToken()}}).success(function(t){o.posts.push(t)})},o.upvote=function(o){return t.put("/posts/"+o._id+"/upvote",null,{headers:{Authorization:"Bearer "+e.getToken()}}).success(function(t){o.upvotes+=1})},o.addComment=function(o,n){return t.post("/posts/"+o+"/comments",n,{headers:{Authorization:"Bearer "+e.getToken()}})},o.upvoteComment=function(o,n){return t.put("/posts/"+o._id+"/comments/"+n._id+"/upvote",null,{headers:{Authorization:"Bearer "+e.getToken()}}).success(function(t){n.upvotes+=1})},o}]),angular.module("posts").controller("PostsCtrl",["$scope","PostsService","post","AuthService",function(t,e,o,n){t.isLoggedIn=n.isLoggedIn,t.post=o,t.addComment=function(){""!==t.body&&(e.addComment(o._id,{body:t.body,author:"user"}).success(function(e){t.post.comments.push(e)}),t.body="")},t.incrementUpvotes=function(t){t.upvotes+=1},t.incrementUpvotes=function(t){e.upvoteComment(o,t)}}]),angular.module("main",["auth","posts"]),angular.module("main").controller("MainCtrl",["$scope","PostsService","AuthService",function(t,e,o){t.isLoggedIn=o.isLoggedIn,t.posts=e.posts,t.addPost=function(){""!==t.title&&(e.create({title:t.title,link:t.link}),t.title="",t.link="")},t.deletePost=function(t){e["delete"](t)},t.incrementUpvotes=function(t){e.upvote(t)}}]);var app=angular.module("flapperNews",["ui.router","auth","nav","posts","main"]);app.config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("home",{url:"/home",templateUrl:"/views/home.html",controller:"MainCtrl",resolve:{postPromise:["PostsService",function(t){return t.getAll()}]}}).state("posts",{url:"/posts/{id}",templateUrl:"/views/post.html",controller:"PostsCtrl",resolve:{post:["$stateParams","PostsService",function(t,e){return e.get(t.id)}]}}).state("login",{url:"/login",templateUrl:"/views/login.html",controller:"AuthCtrl",onEnter:["$state","AuthService",function(t,e){e.isLoggedIn()&&t.go("home")}]}).state("register",{url:"/register",templateUrl:"/views/register.html",controller:"AuthCtrl",onEnter:["$state","AuthService",function(t,e){e.isLoggedIn()&&t.go("home")}]}),e.otherwise("home")}]);